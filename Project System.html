<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Project System</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* === EZ TECH 風格定義 === */
:root { --bg:#020617; --panel:#0f172a; --border:#334155; --text:#e5e7eb; --text-muted:#94a3b8; --blue:#38bdf8; --green:#4ade80; --yellow:#eab308; --red:#ef4444; }
body { margin:0; padding:20px; font-family:"Segoe UI",sans-serif; background:var(--bg); color:var(--text); }

/* 導航列 */
.navbar { display:flex; justify-content:space-between; align-items:center; margin-bottom:30px; padding:20px 30px; background:var(--panel); border-radius:16px; border:1px solid var(--border); box-shadow:0 4px 20px rgba(0,0,0,0.3); }

/* ★★★ 修正重點：標題改回藍色 ★★★ */
.nav-title { font-size:26px; font-weight:800; color:var(--blue); display:flex; align-items:center; gap:10px; }
.nav-title i { color: var(--blue); }

/* 按鈕通用樣式 */
.btn { padding:10px 24px; border-radius:8px; border:none; cursor:pointer; font-weight:bold; font-size:14px; transition:0.2s; display:flex; align-items:center; gap:8px; text-decoration:none;}
.btn:hover { transform:translateY(-2px); filter:brightness(1.1); }
.btn-add { background:var(--blue); color:#000; box-shadow:0 0 15px rgba(56,189,248,0.3); }
.btn-exit { background:var(--border); color:#fff; }

/* === 篩選按鈕群組樣式 === */
.filter-group {
  background: #0f172a; 
  padding: 4px; 
  border-radius: 8px; 
  border: 1px solid var(--border); 
  display: flex; 
  gap: 5px; 
  margin-right: 15px;
}

.btn-filter { 
  padding: 8px 16px; 
  border-radius: 6px; 
  border: 1px solid transparent; 
  background: transparent; 
  color: var(--text-muted); 
  cursor: pointer; 
  font-weight: bold; 
  font-size: 14px; 
  transition: 0.2s; 
}

.btn-filter:hover { color: var(--text); }

/* 三種狀態的激活顏色 */
.btn-filter.active-open { 
  background: var(--red); color: #fff; border-color: var(--red); 
}
.btn-filter.active-close { 
  background: var(--green); color: #000; border-color: var(--green); 
}
.btn-filter.active-all { 
  background: var(--blue); color: #000; border-color: var(--blue); 
}

/* === 表格容器樣式 === */
.table-container {
  background: var(--panel);
  border-radius: 12px;
  border: 1px solid var(--border);
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  overflow-x: auto; 
}

/* 表格本體 */
.proj-table {
  width: 100%;
  border-collapse: collapse;
  text-align: left;
  white-space: nowrap; 
}

.proj-table th, .proj-table td {
  padding: 15px 20px;
  border-bottom: 1px solid var(--border);
  /* ★★★ 修正重點：表格內容強制藍色 ★★★ */
  color: var(--blue); 
}

/* 表頭樣式 */
.proj-table th {
  background: #1e293b; 
  color: #fb923c; /* 表頭維持橘色 */
  font-weight: 700;
  font-size: 14px;
  letter-spacing: 0.5px;
}

/* 表格列滑過效果 */
.proj-table tbody tr:hover {
  background: rgba(56, 189, 248, 0.05); 
}
.proj-table tbody tr:last-child td {
  border-bottom: none;
}

/* 表格內容文字 */
.td-proj-name { font-weight: bold; font-size: 15px; color: var(--blue); }
.td-muted { font-size: 14px; opacity: 0.9; color: var(--blue); }

/* 狀態標籤小藥丸 */
.status-badge {
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: bold;
  text-transform: uppercase;
  display: inline-block;
  color: #fff;
}
.st-Running { background: var(--green); color: #000; box-shadow: 0 0 5px rgba(74, 222, 128, 0.3); }
.st-Suspend { background: var(--red); }
.st-Finish { background: #94a3b8; }

/* 編輯圖示 */
.btn-edit-row {
  cursor: pointer;
  font-size: 16px;
  transition: 0.2s;
  padding: 5px;
  color: var(--blue);
}
.btn-edit-row:hover { filter: brightness(1.2); transform: scale(1.1); }

/* Loading 狀態 */
.loading-row td { text-align: center; padding: 40px; color: var(--text-muted); font-size: 16px; }
</style>
</head>
<body>

<div class="navbar">
  <div class="nav-title"><i class="fa-solid fa-diagram-project"></i> Project List</div>
  
  <div style="display:flex; align-items: center; gap:15px;">
    
    <div class="filter-group">
      <button class="btn-filter active-open" onclick="setFilter('OPEN', this)">Open</button>
      <button class="btn-filter" onclick="setFilter('CLOSE', this)">Close</button>
      <button class="btn-filter" onclick="setFilter('ALL', this)">All</button>
    </div>

    <button class="btn btn-add" onclick="location.href='New Project.html'"><i class="fa-solid fa-plus"></i> New Project</button>
    <button class="btn btn-exit" onclick="location.href='index.html'"><i class="fa-solid fa-right-from-bracket"></i> Exit</button>
  </div>
</div>

<div class="table-container">
  <table class="proj-table">
    <thead>
      <tr>
        <th style="width: 80px;">Status</th>
        <th>Project Name</th>
        <th>Customer</th>
        <th>Tool ID</th>
        <th>Owner</th>
        <th>Start Date</th>
        <th>Due Date</th>
        <th style="width: 60px; text-align: center;">Details</th>
      </tr>
    </thead>
    <tbody id="projectListBody">
      <tr class="loading-row">
        <td colspan="8"><i class="fa-solid fa-spinner fa-spin"></i> Loading Projects...</td>
      </tr>
    </tbody>
  </table>
</div>

<script>
// ★★★ 請確認您的 GAS URL (EZ TECH) ★★★
const API_URL = 'https://script.google.com/macros/s/AKfycbw3f4ch9YxN47QQ_Sa9vuTKk5-Y9yLJumm4wkozjWkxcMqiW9fAhLBxI2Lvd64DRrqn/exec';

let allProjects = []; 
let currentFilter = 'OPEN'; 

window.onload = loadProjects;

function setFilter(type, btn) {
  currentFilter = type;
  
  // 1. 移除所有按鈕的 active 樣式
  document.querySelectorAll('.btn-filter').forEach(b => {
      b.classList.remove('active-open', 'active-close', 'active-all');
  });
  
  // 2. 根據點擊的類型添加對應的顏色樣式
  if (type === 'OPEN') btn.classList.add('active-open');
  else if (type === 'CLOSE') btn.classList.add('active-close');
  else if (type === 'ALL') btn.classList.add('active-all');

  // 3. 重新渲染表格
  renderProjects();
}

function loadProjects() {
  fetch(API_URL, { method: 'POST', body: JSON.stringify({ mode: 'getProjectList' }) })
  .then(r => r.json())
  .then(res => {
    if(!res.list || res.list.length === 0){
        allProjects = [];
    } else {
        allProjects = res.list;
    }
    renderProjects();
  });
}

function renderProjects() {
    const tbody = document.getElementById('projectListBody');
    tbody.innerHTML = ''; 

    const filteredList = allProjects.filter(p => {
        const status = p.Status ? p.Status.toUpperCase() : '';
        if (currentFilter === 'ALL') return true;
        
        // 定義 Close = Finish
        const isClosed = (status === 'FINISH' || status === 'CLOSE' || status === 'COMPLETED');

        if (currentFilter === 'CLOSE') return isClosed;
        if (currentFilter === 'OPEN') return !isClosed; 
        return true;
    });

    if(filteredList.length === 0){
      tbody.innerHTML = '<tr class="loading-row"><td colspan="8">No projects found.</td></tr>';
      return;
    }

    filteredList.forEach(p => {
      const shortStart = p.StartDate ? p.StartDate.substring(5) : '--/--';
      const shortDue = p.DueDate ? p.DueDate.substring(5) : '--/--';

      const row = `
        <tr>
          <td><span class="status-badge st-${p.Status}">${p.Status}</span></td>
          <td class="td-proj-name">${p.ProjectName}</td>
          <td class="td-muted">${p.Customer || '-'}</td>
          <td class="td-muted">${p.ToolID || '-'}</td>
          <td class="td-muted">${p.Owner || '-'}</td>
          <td class="td-muted">${shortStart}</td>
          <td class="td-muted" style="${p.DueDate ? '' : 'opacity:0.5'}">${shortDue}</td>
          <td style="text-align: center;">
            <i class="fa-solid fa-pen-to-square btn-edit-row" 
               onclick="location.href='New Project.html?id=${p.ID}'" 
               title="Details"></i>
          </td>
        </tr>`;
      
      tbody.innerHTML += row;
    });
}
</script>
</body>
</html>