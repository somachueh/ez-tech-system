<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>New Event Record</title>
<style>
  body {
    margin: 0; padding: 20px; font-family: "Segoe UI", sans-serif;
    background: radial-gradient(circle at top, #1e293b, #020617); color: #e5e7eb;
    height: 100vh; box-sizing: border-box; display: flex; flex-direction: column;
  }
  h1 { text-align: center; color: #4ade80; margin: 0 0 20px 0; text-shadow: 0 0 10px rgba(74,222,128,0.3); }

  /* 4欄式 Grid 佈局 */
  .layout-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr; 
    gap: 15px;
    flex: 1; min-height: 0;
  }
  
  .col-span-2 { grid-column: span 2; }
  .col-span-3 { grid-column: span 3; }
  .col-span-4 { grid-column: span 4; }

  .field-group { display: flex; flex-direction: column; }
  label { margin-bottom: 6px; color: #fb923c; font-weight: bold; font-size: 14px; }
  
  input, select, textarea {
    padding: 10px; border-radius: 8px; border: 1px solid rgba(148,163,184,0.25);
    background: #020617; color: #38bdf8; width: 100%; box-sizing: border-box; outline: none;
    font-size: 16px;
  }
  input[type="date"] { color-scheme: dark; }
  textarea { resize: none; height: 100px; }

  /* === PRI 專用樣式 (燈號下拉選單) === */
  select#pri {
    appearance: none; /* 讓背景色滿版 */
    text-align: center;
    font-weight: bold;
    cursor: pointer;
    border: 1px solid transparent;
  }

  /* 燈號顏色定義 */
  .pri-red { background-color: #ef4444 !important; color: white !important; }   /* High */
  .pri-green { background-color: #22c55e !important; color: white !important; } /* Low */
  .pri-yellow { background-color: #eab308 !important; color: black !important; } /* Midd */
  .pri-gray { background-color: #64748b !important; color: white !important; }   /* End */

  /* 右側附件區 */
  .right-sidebar {
    grid-column: 4 / 5; grid-row: 1 / 6;
    display: flex; flex-direction: column; gap: 10px;
    border-left: 1px solid #334155; padding-left: 15px;
  }
  .appendix-box {
    flex: 1; border: 1px dashed #475569; border-radius: 8px;
    display: flex; align-items: center; justify-content: center; color: #64748b; font-size: 12px;
  }

  /* 按鈕 */
  .btn-container { grid-column: 1 / -1; display: flex; gap: 15px; margin-top: auto; }
  .btn {
    flex: 1; padding: 15px; font-size: 18px; border-radius: 12px; border: none;
    cursor: pointer; font-weight: bold;
  }
  .btn-save { background: #16a34a; color: #fff; }
  .btn-exit { background: #1e293b; color: #94a3b8; border: 1px solid #334155; }
</style>
</head>
<body>

  <h1>New Event Record</h1>

  <div class="layout-grid">
    
    <div class="field-group">
      <label>Date *</label>
      <input type="date" id="date">
    </div>

    <div class="field-group">
      <label>PRI (Priority)</label>
      <select id="pri" onchange="updatePriColor()">
        <option value="Low">Low (Green)</option>
        <option value="High">High (Red)</option>
        <option value="Midd">Midd (Yellow)</option>
       </select>
    </div>

    <div class="field-group">
      <label>Project</label>
      <input id="project" placeholder="e.g. PIP, MOD...">
    </div>
    
    <div class="right-sidebar">
      <label>Appendix</label>
      <div class="appendix-box">File 1</div>
      <div class="appendix-box">File 2</div>
      <div class="appendix-box">File 3</div>
    </div>

    <div class="field-group">
      <label>Customer *</label>
      <input id="customer" placeholder="e.g. TSMC">
    </div>
    <div class="field-group">
      <label>Customer Tool ID *</label>
      <input id="toolId" placeholder="e.g. ATFSMA1">
    </div>
    <div class="field-group">
      <label>Tool Type</label>
      <input id="toolType" placeholder="e.g. P5000">
    </div>

    <div class="field-group">
      <label>CH (Chamber)</label>
      <input id="ch" placeholder="e.g. A, B, C">
    </div>
    <div class="field-group col-span-2">
      <label>ENG (Engineer) *</label>
      <input id="eng">
    </div>

    <div class="field-group col-span-3">
      <label>Problem (Event Title) *</label>
      <input id="problem">
    </div>

    <div class="field-group col-span-3">
      <label>Action (Process Describe) *</label>
      <textarea id="action" style="height: 200px;"></textarea>
    </div>

    <div class="btn-container">
      <button class="btn btn-save" onclick="saveEvent()">Create Record</button>
      <button class="btn btn-exit" onclick="location.href='Record System.html'">Exit</button>
    </div>

  </div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbw3f4ch9YxN47QQ_Sa9vuTKk5-Y9yLJumm4wkozjWkxcMqiW9fAhLBxI2Lvd64DRrqn/exec';

// 初始化
window.onload = function(){
  // 設定日期為今天
  document.getElementById('date').value = new Date().toISOString().slice(0,10);
  
  // 初始化 PRI 顏色 (預設 Keep)
  updatePriColor();
};

function updatePriColor(){
  const sel = document.getElementById('pri');
  const val = sel.value;
  
  // 重置 class
  sel.className = ''; 
  
  // 依據值加入對應顏色 class
  if(val === 'Low') sel.classList.add('pri-green');
  else if(val === 'High') sel.classList.add('pri-red');
  else if(val === 'Midd') sel.classList.add('pri-yellow');
  else if(val === 'End') sel.classList.add('pri-gray');
}

function saveEvent(){
  const fields = {
    Date: document.getElementById('date').value,
    Project: document.getElementById('project').value,
    Customer: document.getElementById('customer').value,
    CustomerToolID: document.getElementById('toolId').value,
    ToolType: document.getElementById('toolType').value,
    Chamber: document.getElementById('ch').value,
    PRI: document.getElementById('pri').value, // 取得選單值
    ENG: document.getElementById('eng').value,
    Problem: document.getElementById('problem').value,
    Action: document.getElementById('action').value
  };

  // 必填檢查
  if(!fields.Date || !fields.Customer || !fields.CustomerToolID || !fields.ENG || !fields.Problem){
    alert('❌ Please fill in all required fields (*)');
    return;
  }

  const payload = { ...fields, mode: 'createEvent' };
  
  // 日期格式化
  payload.Date = payload.Date.replace(/-/g, '/');

  const btn = document.querySelector('.btn-save');
  btn.innerText = 'Saving...'; btn.disabled = true;

  fetch(API_URL, { method: 'POST', body: JSON.stringify(payload) })
  .then(r => r.json())
  .then(res => {
    if(res.result === 'OK'){
      alert('✅ Record Created');
      location.href = 'Record System.html';
    } else {
      alert('Error: ' + res.message);
      btn.innerText = 'Create Record'; btn.disabled = false;
    }
  })
  .catch(err => {
    alert('Network Error');
    btn.innerText = 'Create Record'; btn.disabled = false;
  });
}
</script>
</body>
</html>