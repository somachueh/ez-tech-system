<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>Add Log</title>
<style>
  body { margin:0; padding:20px; font-family:"Segoe UI"; background:#020617; color:#e5e7eb; height:100vh; display:flex; flex-direction:column; }
  
  /* 輸入框樣式 */
  input, textarea { 
    width:100%; 
    padding:10px; 
    margin-bottom:15px; 
    background:#0f172a; 
    border:1px solid #334155; 
    color:#38bdf8; 
    border-radius:8px; 
    box-sizing:border-box;
    font-size: 16px;
    font-family: inherit;
    outline: none;
  }
  
  /* 日期選擇器 */
  input[type="date"] { color-scheme: dark; }

  label { color:#fb923c; font-weight:bold; display:block; margin-bottom:5px; }
  
  button { width:100%; padding:15px; font-weight:bold; cursor:pointer; border-radius:10px; border:none; margin-top:10px; font-size: 16px; }
  
  .btn-save { background: #38bdf8; color: #000; }
  .btn-exit { background: #1e293b; color: #fff; border: 1px solid #334155; }
</style>
</head>
<body>
  
  <label>Event ID</label>
  <input id="eid" readonly style="color:#64748b; border: 1px dashed #334155;">
  
  <label>Date</label>
  <input type="date" id="logDate">

  <label>ENG (Engineer)</label>
  <input id="eng">

  <label>Action / Result</label>
  <textarea id="action" style="height:250px"></textarea>

  <button class="btn-save" onclick="save()">Save Log</button>
  <button class="btn-exit" onclick="window.close()">Exit</button>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbw3f4ch9YxN47QQ_Sa9vuTKk5-Y9yLJumm4wkozjWkxcMqiW9fAhLBxI2Lvd64DRrqn/exec';
const p = new URLSearchParams(location.search);
document.getElementById('eid').value = p.get('eventId');

// 初始化日期為今天
document.getElementById('logDate').value = new Date().toISOString().slice(0,10);

function save(){
  const dateInput = document.getElementById('logDate').value;

  const pl = {
    mode: 'addLog',
    EventID: document.getElementById('eid').value,
    LogDate: dateInput.replace(/-/g, '/'), // 傳送格式化日期
    ENG: document.getElementById('eng').value,
    Action: document.getElementById('action').value
  };
  
  if(!pl.LogDate || !pl.ENG || !pl.Action) return alert('❌ Fill all fields');
  
  const btn = document.querySelector('.btn-save');
  btn.innerText = 'Saving...'; btn.disabled = true;

  fetch(API_URL, {method:'POST', body:JSON.stringify(pl)})
  .then(r=>r.json()).then(res=>{
    if(res.result==='OK'){ 
      alert('✅ Log Added'); 
      window.close(); 
    } else { 
      alert('Error: ' + res.message); 
      btn.innerText = 'Save Log'; btn.disabled = false;
    }
  })
  .catch(err => {
    alert('Connection Error');
    btn.innerText = 'Save Log'; btn.disabled = false;
  });
}
</script>
</body>
</html>